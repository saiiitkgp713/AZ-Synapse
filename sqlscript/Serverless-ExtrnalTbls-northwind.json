{
	"name": "Serverless-ExtrnalTbls-northwind",
	"properties": {
		"content": {
			"query": "-- Check if the database exists\nIF EXISTS (\n    SELECT name\n    FROM sys.databases\n    WHERE name = 'northwindDB'\n)\nBEGIN\n    -- Drop the database\n    USE northwindDB;\nEND\n\nDROP EXTERNAL TABLE Customers\nDROP EXTERNAL TABLE Categories\nDROP EXTERNAL TABLE Employees\nDROP EXTERNAL TABLE OrderDetails\nDROP EXTERNAL TABLE Orders\nDROP EXTERNAL TABLE Products\nDROP EXTERNAL TABLE Shippers\nDROP EXTERNAL TABLE Suppliers\n\nDROP EXTERNAL DATA SOURCE northwind\nDROP EXTERNAL FILE FORMAT csvFileformat\n\n-- Check if the database exists\nIF EXISTS (\n    SELECT name\n    FROM sys.databases\n    WHERE name = 'northwindDB'\n)\nBEGIN\n    -- Drop the database\n    DROP DATABASE northwindDB;\nEND\n\nCREATE DATABASE northwindDB\nUSE northwindDB\nALTER DATABASE northwindDB\n  COLLATE Latin1_General_100_BIN2_UTF8 \n\n\n--- Creating External Data Source for our data source (referring container)\nCREATE EXTERNAL DATA SOURCE northwind \nWITH\n(\n    LOCATION = 'https://adeses2rg1strg1.blob.core.windows.net/northwind/'\n    ----,    CREDENTIAL = -needed a scoped credential for access\n)\n\n--- Creating an external file format\nCREATE EXTERNAL FILE FORMAT csvFileformat \nWITH\n(\n\tFORMAT_TYPE = DELIMITEDTEXT,\n    FORMAT_OPTIONS (\n        FIELD_TERMINATOR = ',',        \n        STRING_DELIMITER = '0x22',     ---- For String columns enclosed in \"\" and have a comma in them\n        ENCODING = 'UTF8',\n        FIRST_ROW = 2\n    )\n)\n\n\n-----Directly querying csv files from adlsgen2, for container : northwind\nSELECT TOP 100 *\nFROM\n\tOPENROWSET(\n\t\tBULK 'https://adeses2rg1strg1.blob.core.windows.net/northwind/suppliers.csv',\n\t\tFORMAT = 'csv',\n\t\tHEADER_ROW = TRUE,\n\t\tPARSER_VERSION = '2.0'\n\t) AS shippers\n\n\n\n-----------------------------------------------------------------\n---- creating Categories external table\nCREATE EXTERNAL TABLE Categories\n(\n    [CategoryID] INT,\n    [CategoryName] VARCHAR(200),\n    [Description] VARCHAR(200)\n)\nWITH \n(\n    LOCATION = 'categories.csv',\n    DATA_SOURCE = northwind,\n    FILE_FORMAT = csvFileformat\n)\nSELECT TOP 5 * FROM Categories\n\n\n-----------------------------------------------------------------\n---- creating Customers external table\nCREATE EXTERNAL TABLE Customers\n(\n    [CustomerID] INT,\n    [CustomerName] VARCHAR(50),\n    [ContactName] VARCHAR(50),\n    [Address] VARCHAR(50),\n    [City] VARCHAR(50),\n    [PostalCode] VARCHAR(20),\n    [Country] VARCHAR(20)\n)\nWITH \n(\n    LOCATION = 'customers.csv',\n    DATA_SOURCE = northwind,\n    FILE_FORMAT = csvFileformat\n)\nSELECT TOP 5 * FROM Customers\n\n\n--------------------------------------------------------------\n---- creating Employees external table\nCREATE EXTERNAL TABLE Employees\n(\n    [EmployeeID] INT,\n    [LastName] VARCHAR(50),\n    [FirstName] VARCHAR(50),\n    [BirthDate] DATETIME,\n    [Photo] VARCHAR(20),\n    [Notes] VARCHAR(MAX)\n)\nWITH \n(\n    LOCATION = 'employees.csv',\n    DATA_SOURCE = northwind,\n    FILE_FORMAT = csvFileformat\n)\nSELECT TOP 5 * FROM Employees\n\n\n--------------------------------------------------------------\n---- creating OrderDetails external table\nCREATE EXTERNAL TABLE OrderDetails\n(\n    [OrderDetailID] INT,\n    [OrderID] INT,\n    [ProductID] INT,\n    [Quantity] INT\n)\nWITH \n(\n    LOCATION = 'orderdetails.csv',\n    DATA_SOURCE = northwind,\n    FILE_FORMAT = csvFileformat\n)\nSELECT TOP 5 * FROM OrderDetails\n\n\n\n--------------------------------------------------------------\n---- creating orders external table\nCREATE EXTERNAL TABLE Orders\n(\n    [OrderID] INT,\n    [CustomerID] INT,\n    [EmployeeID] INT,\n    [OrderDate] DATETIME,\n    [ShipperID] INT\n)\nWITH \n(\n    LOCATION = 'orders.csv',\n    DATA_SOURCE = northwind,\n    FILE_FORMAT = csvFileformat\n)\nSELECT TOP 5 * FROM Orders\n\n\n--------------------------------------------------------------\n---- creating Products external table\nCREATE EXTERNAL TABLE Products\n(\n    [ProductID] INT,\n    [ProductName] VARCHAR(50),\n    [SupplierID] INTEGER,\n    [CategoryID] INTEGER,\n    [Unit] VARCHAR(25),\n    [Price] NUMERIC\n)\nWITH \n(\n    LOCATION = 'products.csv',\n    DATA_SOURCE = northwind,\n    FILE_FORMAT = csvFileformat\n)\nSELECT TOP 5 * FROM Products\n\n\n--------------------------------------------------------------\n---- creating Shippers external table\nCREATE EXTERNAL TABLE Shippers\n(\n    [ShipperID] INT,\n    [SHipperName] VARCHAR(25),\n    [Phone] VARCHAR(15)\n)\nWITH \n(\n    LOCATION = 'shippers.csv',\n    DATA_SOURCE = northwind,\n    FILE_FORMAT = csvFileformat\n)\nSELECT TOP 5 * FROM Shippers\n\n\n\n--------------------------------------------------------------\n---- creating Suppliers external table\nCREATE EXTERNAL TABLE Suppliers\n(\n    [SupplierID] INT,\n    [SupplierName] VARCHAR(50),\n    [ContactName] VARCHAR(50),\n    [Address] VARCHAR(50),\n    [City] VARCHAR(20),\n    [PostalCode] VARCHAR(10),\n    [Country] VARCHAR(15),\n    [Phone] VARCHAR(15)\n)\nWITH \n(\n    LOCATION = 'suppliers.csv',\n    DATA_SOURCE = northwind,\n    FILE_FORMAT = csvFileformat\n)\nSELECT TOP 5 * FROM Suppliers\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "northwindDB",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}